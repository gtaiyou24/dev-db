# 関数

 - SELECT句、GROUP BY句、HAVING句で使用することができる
 - 関数の引数に別の関数を指定することも可能。これを関数のネストという。

## 文字関数

| 関数 | 結果 | 説明 |
|:----|:-----|:-----|
| `UPPER('ctct')` | CTCT | 大文字に変換 |
| `LOWER('CTCT')` | ctct | 小文字に変換 |
| `SUBSTR('CTCT', 1, 3)` `SUBSTRING('CTCT', 1, 3)` | CTC | `SUBSTRING( 文字列, 開始位置, 文字数)`.開始位置を指定して指定した文字数だけ文字列を取り出す |
| `INSTR('CTCT', 'T')` | 2 | 指定された文字の位置を返す |
| `LENGTH(文字列)` | 文字列の長さ | 文字列の長さを返す |
| `CONCAT(文字列1, 文字列2)` | 文字列1文字列2 | 値を連結 |
| `RPAD('CTCT', 10, '*')` | CTCT****** | 第二引数で指定した文字数に達するまで文字列1の右側に文字列2を追加する |
| `LPAD('CTCT', 10, '*')` | ******CTCT | 第二引数で指定した文字数に達するまで文字列1の左側に文字列2を追加する |
| `TRIM('C' FROM 'CTCT')` | TCT | 前後の指定した文字を取り除く |
| `REPLACE('CTCT', 'C', 'X')` | XTXT | ある文字(列)を他の文字(列)に置き換える |

 - 上記の関数には、定数/変数/列/式などを引数として使用することができる

## 日付関数

| 関数 | 結果 | 説明 |
|:----|:-----|:-----|
| `NOW()` | 現在日時 | 現在日時を取得 |
| `CURDATE()` | 現在の日にち | 現在の日にちを取得 |
| `CURTIME()` | 現在時刻 | 現在の時刻を取得 |
| `DATEDIFF(日付1, 日付2)` | 2つの日付間の差 | 日付は'2018-5-10'のように指定 |
| `DATE_ADD(日付, INTERVAL 1DAY)` | 日付に1日分を加算 | 日付にINTERVALの期間を加算 |
| `LAST_DAY(日付)` | 日付の月の最終日 |

 - 日付データは、年/月/日/時/分/秒のデータを表現できる


## 数値関数
数値データの四捨五入や切捨てを行う。

| 関数 | 説明 |
|:----|:-----|
| `ROUND(式[, n])` | 式のデータを小数点以下n桁に四捨五入。nが省略された場合は、小数点以下が四捨五入。nが負の場合は、小数点より左n桁で四捨五入 |
| `TRUNCATE(式, n)` | 式のデータを小数点以下n桁に切り捨て.nが負の場合は、小数点より左n桁で切り捨て |
| `MOD(m, n)` | mをnで除算した余りを戻す |

## 一般関数

| 関数 | 説明 |
|:----|:-----|
| `COALESCE(value,...)` | 任意の個数の引数を取り,引数の最初の非NULL値を返す |

## 条件式

```sql
--単純CASE式
CASE gender
    WHEN '男' THEN 1
    WHEN '女' THEN 2
    ELSE 99
END

--検索CASE式
CASE
    WHEN gender = '男' THEN 1
    WHEN gender = '女' THEN 2
    ELSE 99
END
```

https://qiita.com/sfp_waterwalker/items/acc7f95f6ab5aa5412f3

## グループ関数
複数行をグループ化し、グループごとに1つの値を戻す関数

| 関数 | 説明 |
|:----|:-----|
| `SUM(列名)` | 合計値を返す |
| `AVG(列名)` | 平均値を返す |
| `COUNT(列名)` | 行数を返す |
| `MAX(列名)` | 最大値を返す |
| `MIN(列名)` | 最小値を返す |

 - グループ関数では、NULL値は無視
    - NULL値も含めて計算した場合は、`COALESCE`関数と合わせて使用する
    `AVG(COALESCE(列名, 0))`
 - DISTINCTキーワードによる重複排除が可能

---
## GROUP BY句
```sql
SELECT 列リスト 
FROM テーブル名 
[WHERE 条件式]
GROUP BY グループ列名 [, グループ列名, ...]
;
```

GROUP BY句を使用すると、行データをグループ化することができる。指定した列の値が等しい行をグループ化し、
**<font color="red">グループ関数によってそのグループごとの集計を行います</font>**

## HAVING句

```sql
SELECT 列リスト
FROM テーブル名
[WHERE 条件式]
GROUP BY グループ列名
HAVING 条件式
[ORDER BY ソート条件]
;
```

> - 一般的に、GROUP BY句とともに使用
>
> グループ化したデータに対して、さらに条件を追加したい場合は、HAVING句を使用する。この句は、グループ化された後のグループに対する検索条件を指定している。<br>
> また、WHERE句ではグループ関数を使用した条件を指定することはできません。

